# 文档模板参考

本文档提供需求文档和详细设计文档的标准模板结构,供 Claude 在 Step 2 生成文档时参考。

---

## 需求文档模板

```markdown
# [项目名称] 需求文档

## 1. 项目概述

### 1.1 项目背景
[描述项目产生的背景和动机,为什么需要这个项目]

### 1.2 项目目标
[列出要达成的具体目标,使用 SMART 原则: 具体、可衡量、可实现、相关、有时限]

### 1.3 项目范围
- **包含范围**: [明确列出项目包含的功能和模块]
- **不包含范围**: [明确列出项目不包含的内容,避免范围蔓延]

---

## 2. 功能需求

### 2.1 核心功能

#### 功能 1: [功能名称]
- **描述**: [详细描述功能的目的和行为]
- **优先级**: 高/中/低
- **用户故事**: 作为 [角色],我希望 [功能],以便 [价值]
- **验收标准**:
  - [ ] 标准 1
  - [ ] 标准 2
  - [ ] 标准 3

#### 功能 2: [功能名称]
[重复上述结构]

### 2.2 辅助功能
[描述非核心但必要的功能]

---

## 3. 非功能需求

### 3.1 性能要求
- **响应时间**: < X ms
- **并发用户**: > Y 人
- **数据处理量**: Z 条/秒
- **系统吞吐量**: [具体指标]

### 3.2 安全要求
- **认证方式**: [JWT / OAuth2 / Session 等]
- **授权机制**: [RBAC / ABAC 等]
- **数据加密**: [传输层加密 / 存储加密]
- **审计日志**: [记录内容和保留时间]

### 3.3 可用性要求
- **系统可用性**: 99.X%
- **故障恢复时间**: < Y 分钟
- **数据备份**: [备份策略和频率]

### 3.4 兼容性要求
- **浏览器支持**: [Chrome XX+, Firefox XX+, Safari XX+]
- **操作系统**: [Windows / macOS / Linux]
- **移动端**: [iOS XX+, Android XX+]
- **依赖版本**: [语言版本、框架版本等]

---

## 4. 用户界面要求

[如适用,描述 UI/UX 要求]
- 界面风格: [现代化 / 简约 / 等]
- 布局要求: [响应式 / 固定宽度 / 等]
- 交互方式: [点击 / 拖拽 / 手势 / 等]
- 无障碍访问: [WCAG 等级]

---

## 5. 数据要求

### 5.1 数据实体

#### 实体 1: [实体名称]
- **字段列表**:
  - 字段1: [类型] - [描述]
  - 字段2: [类型] - [描述]
  - ...

#### 实体 2: [实体名称]
[重复上述结构]

### 5.2 数据关系
[描述实体之间的关系: 一对一、一对多、多对多]

### 5.3 数据量估算
- 初期数据量: [X 条]
- 增长速率: [Y 条/月]
- 3年后预估: [Z 条]

---

## 6. 外部接口

### 6.1 API 接口
- **接口 1**: [名称] - [描述]
- **接口 2**: [名称] - [描述]

### 6.2 第三方集成
- **服务 1**: [名称] - [用途]
- **服务 2**: [名称] - [用途]

### 6.3 数据导入/导出
- 支持格式: [CSV / JSON / XML / 等]
- 批量操作: [是 / 否]

---

## 7. 约束条件

### 7.1 技术约束
[列出必须遵守的技术限制]

### 7.2 业务约束
[列出业务规则和限制]

### 7.3 时间约束
[项目时间要求]

### 7.4 资源约束
[人力、硬件、预算等资源限制]

---

## 8. 验收标准

### 8.1 功能验收
- [ ] 所有核心功能正常运行
- [ ] 所有用户故事完成
- [ ] 通过所有单元测试
- [ ] 通过集成测试
- [ ] 通过用户验收测试

### 8.2 质量验收
- [ ] 代码覆盖率 > X%
- [ ] 无严重 bug
- [ ] 无安全漏洞
- [ ] 符合编码规范
- [ ] 性能指标达标

### 8.3 文档验收
- [ ] 用户手册完整
- [ ] API 文档完整
- [ ] 部署文档完整
- [ ] 代码注释充分

---

## 9. 附录

### 9.1 术语表
- **术语 1**: [定义]
- **术语 2**: [定义]

### 9.2 参考文档
- [文档名称]: [链接或位置]

### 9.3 相关标准
- [标准名称]: [描述]
```

---

## 详细设计文档模板

```markdown
# [项目名称] 详细技术设计

## 1. 系统架构

### 1.1 整体架构

[插入架构图或使用文字描述]

```
┌─────────────┐
│   前端层    │ (如适用)
└──────┬──────┘
       │
┌──────┴──────┐
│  API网关层  │
└──────┬──────┘
       │
┌──────┴──────┐
│  业务逻辑层 │
└──────┬──────┘
       │
┌──────┴──────┐
│  数据访问层 │
└──────┬──────┘
       │
┌──────┴──────┐
│   数据库    │
└─────────────┘
```

### 1.2 技术栈选择

#### 后端技术
- **语言**: [Python / Node.js / Java / Go / ...]
  - 版本: [X.Y.Z]
  - 选型理由: [为什么选择这个语言]
- **框架**: [Django / Flask / Express / Spring Boot / ...]
  - 版本: [X.Y.Z]
  - 选型理由: [为什么选择这个框架]
- **数据库**: [PostgreSQL / MySQL / MongoDB / Redis / ...]
  - 版本: [X.Y.Z]
  - 选型理由: [为什么选择这个数据库]

#### 前端技术 (如适用)
- **框架**: [React / Vue / Angular / ...]
- **状态管理**: [Redux / Vuex / MobX / ...]
- **UI 库**: [Material-UI / Ant Design / ...]

#### 其他工具
- **版本控制**: Git
- **测试框架**: [pytest / jest / JUnit / ...]
- **CI/CD**: [GitHub Actions / GitLab CI / Jenkins / ...]
- **容器化**: [Docker / Kubernetes / ...]
- **API 文档**: [OpenAPI / Swagger / ...]

### 1.3 架构模式
- **设计模式**: [MVC / MVVM / 微服务 / 单体 / ...]
- **分层结构**:
  - 表示层: [职责]
  - 业务逻辑层: [职责]
  - 数据访问层: [职责]
  - 数据层: [职责]

---

## 2. 模块设计

### 2.1 模块 1: [模块名称]

#### 2.1.1 职责
[该模块的核心职责和功能边界]

#### 2.1.2 输入/输出
- **输入**: [数据格式、来源]
- **输出**: [数据格式、去向]

#### 2.1.3 核心类/函数

##### 类: `ClassName`
- **职责**: [类的职责]
- **属性**:
  - `attribute1`: [类型] - [描述]
  - `attribute2`: [类型] - [描述]
- **方法**:
  - `method1(param1, param2)`: [描述]
  - `method2()`: [描述]

##### 函数: `function_name()`
```python
def function_name(param1: Type1, param2: Type2) -> ReturnType:
    """
    功能描述

    参数:
        param1: [描述]
        param2: [描述]

    返回:
        [描述]

    异常:
        ValueError: [何时抛出]
    """
```

#### 2.1.4 依赖关系
- **依赖模块**: [模块 X, 模块 Y]
- **被依赖模块**: [模块 Z]

### 2.2 模块 2: [模块名称]
[重复上述结构]

---

## 3. 接口设计

### 3.1 内部接口

#### 接口 1: `module_a.function_x()`
```python
def function_x(param1: Type1, param2: Type2) -> ReturnType:
    """
    功能描述: [...]

    参数:
        param1: [描述]
        param2: [描述]

    返回:
        [描述]

    异常:
        ValueError: [何时抛出]
        TypeError: [何时抛出]
    """
    pass
```

### 3.2 外部接口 (API)

#### API 1: 获取资源列表
- **端点**: `GET /api/resources`
- **描述**: [接口功能描述]
- **请求参数**:
  - **Query 参数**:
    - `page`: integer (可选) - 页码,默认 1
    - `limit`: integer (可选) - 每页数量,默认 20
    - `filter`: string (可选) - 过滤条件
- **请求头**:
  - `Authorization`: Bearer {token} (必需)
- **响应**:
  ```json
  {
    "status": "success",
    "data": [
      {
        "id": "123",
        "name": "Resource Name",
        "created_at": "2025-12-12T10:00:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 10,
      "total_items": 200
    }
  }
  ```
- **错误码**:
  - 400: 请求参数错误
  - 401: 未授权
  - 403: 无权限
  - 500: 服务器错误

#### API 2: 创建资源
- **端点**: `POST /api/resources`
- **描述**: [接口功能描述]
- **请求体**:
  ```json
  {
    "name": "string (必需)",
    "description": "string (可选)",
    "type": "string (必需)"
  }
  ```
- **响应**:
  ```json
  {
    "status": "success",
    "data": {
      "id": "124",
      "name": "Resource Name",
      "created_at": "2025-12-12T10:05:00Z"
    }
  }
  ```

---

## 4. 数据模型

### 4.1 数据库设计

#### 表 1: users
| 字段名 | 类型 | 约束 | 说明 | 示例 |
|--------|------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 用户ID | 1 |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 | john_doe |
| email | VARCHAR(100) | UNIQUE, NOT NULL | 邮箱 | john@example.com |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希 | $2b$12$... |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 2025-12-12 10:00:00 |
| updated_at | TIMESTAMP | ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 2025-12-12 10:30:00 |

#### 表 2: [表名]
[重复上述结构]

### 4.2 数据关系
```
users (1) ─────< (N) posts
  │
  └─────< (N) comments

posts (1) ─────< (N) comments

categories (N) ─────< (M) posts (多对多,通过中间表)
```

### 4.3 索引设计
- **users.email**: B-tree 索引 (加速登录查询)
- **posts.created_at**: B-tree 索引 (按时间排序查询)
- **posts.user_id**: B-tree 索引 (外键查询)
- **posts.title**: 全文索引 (搜索功能)

---

## 5. 核心算法

### 5.1 算法 1: [算法名称]

#### 目的
[为什么需要这个算法,解决什么问题]

#### 输入/输出
- **输入**: [数据类型和格式]
- **输出**: [数据类型和格式]

#### 算法描述
[用自然语言描述算法步骤]

#### 伪代码
```
ALGORITHM AlgorithmName(input)
    Step 1: Initialize variables
    Step 2: Process input data
    Step 3: Perform main computation
    Step 4: Generate output
    RETURN result
```

#### 时间复杂度
- 最佳情况: O(X)
- 平均情况: O(Y)
- 最坏情况: O(Z)

#### 空间复杂度
O(N)

#### 示例
输入: [示例输入]
输出: [示例输出]

---

## 6. 安全设计

### 6.1 认证机制
- **方案**: JWT / Session / OAuth2
- **Token 过期时间**: X 小时
- **刷新机制**: [描述刷新 token 的流程]
- **多设备登录**: [是否支持,如何处理]

### 6.2 授权机制
- **模型**: RBAC (基于角色) / ABAC (基于属性)
- **角色定义**:
  - admin: [权限列表]
  - user: [权限列表]
  - guest: [权限列表]
- **权限检查**: [在哪里进行权限验证]

### 6.3 数据安全
- **密码加密**: bcrypt (cost factor: 12)
- **敏感数据加密**: AES-256
- **SQL 注入防护**: 使用参数化查询 / ORM
- **XSS 防护**: 输出转义,CSP 策略
- **CSRF 防护**: CSRF token
- **API 限流**: [每分钟 X 次请求]

### 6.4 安全审计
- **日志记录**: 记录所有敏感操作
- **异常监控**: 监控异常登录、API 滥用
- **定期审计**: [审计频率和内容]

---

## 7. 性能优化

### 7.1 数据库优化
- **查询优化**: 使用索引,避免 N+1 查询
- **连接池**: 最大连接数 X
- **慢查询监控**: 记录超过 Y ms 的查询
- **数据分区**: [是否需要,分区策略]

### 7.2 缓存策略
- **缓存层**: Redis / Memcached
- **缓存内容**: [列出需要缓存的数据]
- **过期策略**: LRU / TTL
- **缓存更新**: [何时更新缓存]

### 7.3 并发处理
- **并发模型**: 异步 / 多线程 / 多进程
- **锁机制**: 乐观锁 / 悲观锁
- **队列**: [是否使用消息队列]

### 7.4 前端优化 (如适用)
- **资源压缩**: Gzip / Brotli
- **懒加载**: 图片懒加载,代码分割
- **CDN**: 静态资源 CDN 加速

---

## 8. 错误处理

### 8.1 异常分类
- **业务异常**: ValidationError, ResourceNotFoundError, DuplicateError
- **系统异常**: DatabaseError, NetworkError, TimeoutError

### 8.2 错误码设计
| 错误码 | 说明 | HTTP 状态码 |
|--------|------|-------------|
| 1001 | 参数验证失败 | 400 |
| 1002 | 资源不存在 | 404 |
| 1003 | 资源已存在 | 409 |
| 2001 | 数据库错误 | 500 |
| 2002 | 外部服务错误 | 502 |

### 8.3 日志策略
- **日志级别**: DEBUG / INFO / WARNING / ERROR / CRITICAL
- **日志格式**: JSON 结构化日志
- **日志内容**:
  - 时间戳
  - 日志级别
  - 请求 ID
  - 用户 ID (如适用)
  - 错误堆栈 (如适用)
- **日志存储**: 文件轮转 (每天 / 每 100MB)
- **日志聚合**: [是否使用 ELK / Splunk 等]

---

## 9. 测试策略

### 9.1 单元测试
- **覆盖率目标**: > 80%
- **测试框架**: pytest / unittest / jest / JUnit
- **Mock 策略**: 对外部依赖进行 mock
- **测试内容**:
  - 所有业务逻辑函数
  - 边界条件
  - 异常处理

### 9.2 集成测试
- **测试场景**: [列出关键业务流程]
- **测试环境**: 独立的测试环境
- **测试数据**: 使用测试数据库

### 9.3 性能测试
- **负载测试**: [目标并发用户数]
- **压力测试**: [系统极限测试]
- **工具**: JMeter / Locust / k6

### 9.4 安全测试
- **漏洞扫描**: OWASP Top 10
- **渗透测试**: [是否需要]

---

## 10. 部署方案

### 10.1 部署架构
```
┌──────────────┐
│  负载均衡器  │
└──────┬───────┘
       │
    ┌──┴──┐
┌───┴──┐ ┌┴───┐
│ 服务1│ │服务2│
└───┬──┘ └┬───┘
    └──┬──┘
       │
┌──────┴──────┐
│   数据库    │
└─────────────┘
```

### 10.2 环境配置
- **开发环境**: 本地开发,使用 SQLite / 本地数据库
- **测试环境**: 与生产环境配置相近,独立数据库
- **生产环境**: [详细配置]

### 10.3 CI/CD 流程
```
代码提交 → 自动构建 → 单元测试 → 代码检查 →
集成测试 → 部署到测试环境 → 手动验收 → 部署到生产环境
```

### 10.4 容器化 (如适用)
- **Dockerfile**: [关键配置]
- **docker-compose**: [服务编排]
- **Kubernetes**: [是否使用 k8s]

---

## 11. 项目结构

### 11.1 目录结构
```
project/
├── src/                    # 源代码
│   ├── main.py            # 应用入口
│   ├── models/            # 数据模型
│   │   ├── __init__.py
│   │   ├── user.py
│   │   └── post.py
│   ├── views/             # 视图层 (API handlers)
│   │   ├── __init__.py
│   │   ├── user_views.py
│   │   └── post_views.py
│   ├── services/          # 业务逻辑层
│   │   ├── __init__.py
│   │   ├── user_service.py
│   │   └── auth_service.py
│   ├── repositories/      # 数据访问层
│   │   ├── __init__.py
│   │   ├── user_repo.py
│   │   └── post_repo.py
│   └── utils/             # 工具函数
│       ├── __init__.py
│       ├── validators.py
│       └── helpers.py
├── tests/                 # 测试代码
│   ├── unit/             # 单元测试
│   │   ├── test_user_service.py
│   │   └── test_auth.py
│   └── integration/      # 集成测试
│       └── test_api.py
├── docs/                  # 文档
├── config/                # 配置文件
│   ├── development.py
│   ├── testing.py
│   └── production.py
├── migrations/            # 数据库迁移
├── requirements.txt       # Python 依赖
├── Dockerfile             # Docker 配置
├── docker-compose.yml     # Docker Compose
├── .gitignore
└── README.md
```

### 11.2 文件说明
- **main.py**: 应用入口,初始化配置和路由
- **models/**: 定义数据模型和 ORM 映射
- **views/**: 处理 HTTP 请求和响应
- **services/**: 实现业务逻辑
- **repositories/**: 封装数据库操作
- **utils/**: 通用工具函数

---

## 12. 开发规范

### 12.1 编码规范
- **语言规范**: 遵循 PEP8 (Python) / ESLint (JavaScript) / 等
- **命名约定**:
  - 类名: PascalCase
  - 函数/变量: snake_case (Python) / camelCase (JavaScript)
  - 常量: UPPER_SNAKE_CASE
  - 私有成员: _leading_underscore
- **注释要求**:
  - 所有公共函数必须有文档字符串
  - 复杂逻辑必须有行内注释
  - 类必须有描述其职责的文档字符串

### 12.2 Git 工作流
- **分支策略**: Git Flow / GitHub Flow
  - main: 生产环境代码
  - develop: 开发分支
  - feature/*: 功能分支
  - bugfix/*: Bug 修复分支
  - hotfix/*: 紧急修复分支
- **Commit 规范**: Conventional Commits
  - feat: 新功能
  - fix: Bug 修复
  - docs: 文档更新
  - refactor: 代码重构
  - test: 测试相关
  - chore: 构建/工具相关
- **Code Review**: 至少 1 人审核后才能合并

### 12.3 文档规范
- README 必须包含: 项目介绍、安装步骤、使用方法
- API 文档使用 OpenAPI 规范
- 代码中的文档字符串使用统一格式

---

## 13. 风险评估

### 13.1 技术风险
- **风险 1**: [描述风险]
  - **影响**: [影响范围和程度]
  - **概率**: 高/中/低
  - **缓解措施**: [如何降低风险]

### 13.2 性能风险
- **风险 1**: [描述风险]
  - **缓解措施**: [如何应对]

### 13.3 安全风险
- **风险 1**: [描述风险]
  - **缓解措施**: [安全措施]

---

## 14. 附录

### 14.1 术语表
- **术语 1**: [定义]
- **术语 2**: [定义]

### 14.2 参考文档
- [文档名称]: [链接或位置]
- [技术文档]: [链接]

### 14.3 变更历史
| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| 1.0 | 2025-12-12 | [作者] | 初始版本 |
```

---

## 使用说明

### 何时使用这些模板

在 Step 2 (需求分析阶段),Claude 应该参考这些模板来生成需求文档和详细设计文档。

### 如何使用

1. **根据项目规模调整**: 小项目可以简化部分章节,大项目需要更详细
2. **确保完整性**: 必须包含所有���键章节,不能省略重要信息
3. **保持一致性**: 使用统一的格式和术语
4. **注重可读性**: 使用清晰的结构和格式,方便 Codex 理解

### 质量检查清单

生成文档后,检查:
- [ ] 所有章节都已填写
- [ ] 技术细节充分 (接口定义、数据结构等)
- [ ] 包含示例和说明
- [ ] 验收标准明确
- [ ] Markdown 格式正确
- [ ] Codex 能够直接理解和实现

---

**注意**: 这些模板是参考指南,不是强制要求。应根据具体项目需求灵活调整。
